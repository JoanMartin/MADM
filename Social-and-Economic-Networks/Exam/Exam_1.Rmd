---
title: "Social and economic networks"
subtitle: "Handout Exam Part 1"
author: "Juan José Martín y Christian Strasser"
output:
  html_document:
    number_sections: false
    highlight: tango
    toc: yes
    df_print: paged
editor_options: 
  chunk_output_type: console
---



<style type="text/css">

  body {
    background-color: #f6f7fd; 
  }
  
  a:link {
    color: #0174DF;
  }
  
  code.r {
    font-size: 14px;
  } 
  
  div pre {
    background-color:#E0ECF8;
  }
  pre {
    font-size: 14px 
  }
 
  p {
    text-align: justify;
  }
 
    
  h1, h2, h3, h4, h5, h6 {
    color: #737aaa;
  }

  th {  
    background-color:#737aaa;
    color: #FAFAFA;
    padding:5px;
  }
  
  td {
    font-size: 11.5pt;
  } 
  
  tr:nth-child(even){
    background: white;
  }
  
  tr:nth-child(odd){ 
    background-color: #EFF8FB;
  }
</style>

***  


```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=8, fig.height=8, fig.align="center", echo=TRUE, warning=FALSE, message=FALSE)
library(centiserve)
library(igraph)
```


**1)** (2 points) Do Exercise 7 in Chapter 3 (pages 95–97) in Easley-Kleinberg’s Networks, Crowds, and Markets (you have a copy of the book in the course’s Virtual Classroom).

You're helping two program oficers at a large philanthropic foundation decide how best to approach a potential donor to raise the idea of making a very large gift. The donor will be at a two-day meeting where the foundation knows someone who may be able to set the process in motion.

Using some background research, they've created a social network of the people who will be at the meeting, shown in Figure 3.26. The nodes are the people, and there is an edge joining each pair of people who know each other personally. The donor they hope to approach is named Zoe (see the figure), and Vikram, a long-time friend of the foundation, will also be at the meeting and is their starting point for approaching Zoe. The problem is that Vikram doesn't know Zoe personally, and the program oficers at the foundation don't think it would be efective for him to approach her directly. Instead, they want him to get the help of other people at the meeting in relaying the request. The two program oficers you're talking to disagree, however, on what the best strategy is.

\includegraphics[width=250pt]{red_ejercicio1.png}

The younger program oficer, who's more conversant with social-networking technology, favors having Vikram ask Ursula to talk to Zoe about the gift, since the path through Ursula | with only two steps | is the unique shortest path in the social network from Vikram to Zoe, and therefore it involves the fewest steps to relay the request. The older program oficer sees the reasoning behind this, but is puzzled, since her intuition before seeing the picture of the social network (just based on her personal knowledge of the people at the meeting) was that the best strategy would actually be to have Vikram have a conversation with Yoram, suggesting in this conversation that Yoram ask Wendy to raise the idea of the gift with Zoe.

They come to you with this question, since you know about networks. Is there any basis in the structure of the social network itself to support the older program oficer's intuition that going through Yoram and Wendy might be the better strategy, or does the social network structure conclusively support the argument that the best strategy is to use the short path through Ursula? Give an explanation for your answer.

<br>

Existen diferentes maneras de ver este problema:

Como sugiere el primer programador, la ruta más corta del nodo Vikram hacia el nodo Zoe es a partir de Ursula. Si suponemos que todas las amistades son del mismo nivel en esta red, transmitir el mensaje por el camino más corto se consideraría lo más oportuno. En cambio, si las conexiones entre las personas de la red no tienen el mismo nivel o los mensajes no son transmitidos igual de rápidos en todos los nodos de la red, esto serían características a tener en cuenta a la hora de decidir qué tipo de mensaje será tranmitido por quien en esta red.
La segunda programadora habla de transmitir el mensaje a partir de otros dos nodos diferentes, Yoram y Wendy. Se comenta en el enunciado que esto lo hace basado en 'intuición personal' de las personas, lo cual afirma que no todas las personas de la red tienen el mismo nivel de amistad. Pero, a partir de la representación de la red (sin pesos en las aristas u otros atributos), no podemos afirmar esta base.

Así pues, con la simple información de la estructura de la red que nos aporta el enunciado, podriamos afirmar que la decisión más adecuada sería la del primer programador, eligiendo el camino más corto entre Vikram y Zoe. Pero por otro lado, para realizar una decisión más elaborada, también podriamos exigir más información sobre la estructura de la red:
- Pesos en las aristas, que representan el tiempo que tarda un mensaje en pasar por este enlace.
- Atributo de 'amistad' en las aristas, que califica el tipo de amistad entre dos nodos enlazados. No todos los mensajes pueden pasar por todos los enlaces.
Con esto, podría ocurrir que la intuición de la segunda programadora es la más adecuada, si esa ruta cumple con los requisitos de ser el enlace más corto y por donde el mensaje está 'permitido' pasar.

**2)** (2 points) Let $V$ be a partition of an undirected graph $G$. For every community $X_r \E V$, let $a_r$ be the fraction of edges incident to nodes in $X_r$, and for every $X_r,X_s \E V$, let $e_{r, s}$ be the fraction of edges in $G$ that link nodes in $X_r$ with nodes in $X_s$.

*(a)* Write an expression for the modularity $Q(V)$ of the partition $V$ in terms of these quantities $a_r$ and $e_r,_s$.

$$Q(v) = \sum^k_1(e_{r, s} - a^2_r)$$
ers: aristas que conectan nodos de la comunidad r y s (incluye el caso donde s=r)
ar: aristas que conectan nodos dentro de la comunidad r
eii = ers - ar : 

*(b)* In the AMEN (_AIDS_ in Multi-Ethnic Neighborhoods) study (1992), the following frequencies of ethnicities in a large sample of heterosexual couples in San Francisco were recorded

TABLA

Consider the undirected network of relationships for the sample studied and the partition defined by the nodes’ ethnicity (black, hispanic, white, and other). Compute the modularity of this partition. Assuming that the sample was representative of their community, what can you conclude about ethnic homophily in this community?

A partir de la tabla, hay 8 comunidades (4 hombres . 4 mujeres)

matriz adjacente
0000XXXX
0000XXXX
0000XXXX
0000XXXX
XXXX0000
XXXX0000
XXXX0000
XXXX0000

Hacer solo con los 'X'
    
-Utilizar esta matriz en la formula
-Modularidad negativa significa que no puedes obtener esta matriz con un modelo aleatorio porque hay reglas prederterminadas.
-Valor absoluto > 0.3 -> tiene tendencia a crear grupos de comunidades. Tiene tendencia a generar diferentes comunidades

**3)** (2 points) Consider the configuration model where a fraction $p_1$ of nodes have degree 1 and the remaining fraction of nodes $p_3 = 1 - p_1$ have degree 3. Let us consider, to fix ideas, networks of order $n = 10^4$.

*(a)* Take first $p_1 = 0.5$, $p_3 = 0.5$. Estimate through a simulation the expected fraction of a network of order $n = 10^4$ covered by its largest component.

```{r}
library(igraph)
v = sample(x = c(1,3), size = 10^4, replace = TRUE, prob = c(0.5,0.5))
```

```{r}
simulacion_ej3 = function(p1,p3){
  v = sample(x = c(1,3), size = 10^4, replace = TRUE, prob = c(p1,p3))
  g = sample_degseq(out.deg = v, method = "simple.no.multiple")
  return(c(max(components(g)$csize)/gorder(g)*100))
}
```

```{r}
Avg_largest = replicate(100, simulacion_ej3(0.5,0.5))
```

```{r}
mean(Avg_largest)
```

*(b)* Now, plot a graph of the expected fraction (estimated through simulations) of a network of order $n = 10^4$ covered by its largest component for values of $p_1$ from 0 to 1 in 0.01 steps. According to your graph, what is the probability $p_1$ at which the giant component disappears? Is your estimate consistent with the theory?

```{r}
Avg_largest_l = c()
for(p1 in seq(from=0, to=1, by=0.01)){
  p3 = 1 - p1
  Avg_largest = replicate(50, simulacion_ej3(p1,p3))
  Avg_largest_l = c(Avg_largest_l, mean(Avg_largest))
}
```

```{r}
matplot(x=seq(from=0, to=1, by=0.01), y=Avg_largest_l,pch=19,col="red",type="b",ylab="Tamaño de componente", xlab="Valor de p1")
```

Cuantos mas nodos de grado 1 tenga, más disperso es el grafo.

**4)** (4 points) Stochastic models can be used to predict links in a network. Now, in a homework you were asked to produce an ERGM of Grey’s Anatomy sexual contact network. Using your model (or a friend’s, if you did not deliver this homework):

*(a)* What is the link in the network with the highest probability (or the links, in the case of ties)? Look up somewhere on the Internet whether the corresponding contact appeared early or late in the series. 

*(b)* What is the most probable new (that is, absent from the network) sexual contact between a pair of characters in that network? Look up somewhere on the Internet whether this contact has occurred in the series after season 8, and (if the answer is positive) when.

*(d)* What approach do you consider more reasonable to answer questions (a) and (b) for this specific network, the ERGM one or the SBM one? Justify your answer.

**5)** (4 points) I want you to design networks where the most central nodes with respect to some set $S$ of centrality measures are different.

*(a)* Build, by hand, a small network that has this property with respect to $S = \{degree, betweenness\}$. That is, where no node with highest degree is a node with highest betweenness. Plot the network, indicating the nodes of highest degree and of highest betweenness. Explain the strategy you followed to build your
network with the desired property. 

*(b)* Build, by hand, a small network that has this property with respect to $S = \{closeness, betweenness\}$. Plot the network, indicating the nodes of highest closeness and of highest betweenness. Explain the strategy you followed to build your network with the desired property.

*(c)* Now, write a program that searches the space of all connected networks of a given size $n$ and either finds a network with this property for $S = \{degree, betweenness, closeness, eigenvector\}$ or reports that there is no such network for this $n$. Run your program starting with $n = 4$ and provide a smallest network (with least order, and among those with this order, with least size) with this property. Plot the network, indicating which are the nodes with the highest centrality values. What are the features of the network that make the most central nodes according to the different centrality measures to be different? If necessary, to hint the answer to this question, find some more networks with this property.





