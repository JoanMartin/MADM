---
title: "Còdigo del Trabajo Final"
subtitle: '**Aprendizaje supervisado y toma de decisiones**'
author: Maria del Mar Bibiloni Femenias
output:
  html_document:
    number_sections: false
    theme: default
    highlight: tango
    df_print: paged
editor_options: 
  chunk_output_type: console
---


<style type="text/css">
  
  a:link {
    color: #0174DF;
  }
  
  code.r {
    font-size: 14px;
  } 
  
  div pre {
    background-color:#E0ECF8;
  }
  pre {
    font-size: 14px 
  }
 
  p {
    text-align: justify;
  }
 
  h1, h2, h3, h4, h5, h6 {
    color: #088A85;
  }

  th {  
    background-color:#088A85;
    color: #FAFAFA;
    padding:5px;
  }
  
  td {
    font-size: 11.5pt;
  } 
  
  tr:nth-child(even){
    background: white;
  }
  
  tr:nth-child(odd){ 
    background-color: #EFF8FB;
  }
</style>

<br>

***


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

En este documento se prentende mostrar todo el código utilizado para realizar el trabajo final de la asignatura _Aprendizaje estadístico y toma de deciciones_.

_No terminado; sólo aparecen algunas notas._

##Sobre los datos originales

Los datos de mamografías a mujeres con tumores benignos y malignos se pueden descargar del repositiorio UCI, [aquí](http://archive.ics.uci.edu/ml/datasets/Mammographic+Mass).


Cargamos los datos.
```{r}
original_data= read.table("mammographic_masses.data.txt", sep=",", header=FALSE) 
```

Nombramos las columnas.

```{r}
colnames(original_data) <- c("BI-RADS", "Age", "Shape", "Margin", "Density", "Severity")
```


Vemos las primeras filas.
```{r}
head(original_data,10)
```

Dimensiones.
```{r}
matrix(dim(original_data),nrow=2, ncol=1, dimnames=list(c("Observations: ","Predictors:"), ""))
```

Benign-Malign
```{r}
apply(original_data[,-2], 2, function(x) table(x))
```

En BI-RADS un valor se nos sale del rango: 55.
Podemos suponer que es 5 o quitar la observación. La quitamos.

```{r}
data<-original_data
data=data[-which(original_data$`BI-RADS`==55),]
apply(data[,-2], 2, function(x) table(x))
```


###NaN

Veamos cuantos NaN tenemos por columna.
```{r}
data[data=="?"]<- NaN
apply(data, 2, function(x) sum(is.na(x)))
```

Salvo la edad, no es conveniente cambiar los NaN por algun otro valor.
(edad solo 2 NaN)
Así, nos quedamos sólo con las observaciones completas.

```{r}
data <- data[complete.cases(data),]
dim(data)
```


###Train-Test

Tomamos 2/3 de los datos aleatoriamente y los guardamos como train.
La idea es no usar este conjunto para entrenar ningún modelo y así evitar el overfitting.

```{r}
set.seed(1123)
train=sample(nrow(data), size = ceiling(2/3*nrow(data)) )
test=c(1:nrow(data))[-train]
```

En los daos originales hay una buena proporción de casos de tumor benigno y maligno, es decir, no es un problema no balanceado. No hay que modificar la muestra.

Hay que comprobar si se mantiene, aproximadamente, la proporción en _test_ y _train_.

```{r}
matrix(c( table(original_data$Severity)/nrow(original_data),
table(data[train,]$Severity)/length(train),
table(data[test,]$Severity)/length(test) ), nrow=3, ncol=2, byrow = TRUE,
dimnames=list(c("Original set ","Train set", "Test set"), c("Benign (0)","Malign(1)")) )
```

Se mantiene. Ya tenemos los conjuntos de entrenamiento y validación.

###Variables Dummy

Tenemos varias variabes cuantitativas (ordinales y nominales), por tanto, para usar varios métodos de regresión necesitaremos crear variables dummies.


Crear dummies:
```{r}
library("dummies")
data_dum <-dummy.data.frame(data, names=c("BI-RADS","Shape", "Margin", "Density"), sep="_")
head(data_dum)
```

Quitamos las columnas que seran la categoria referencia.

* BI_RADS: 0, incompleto.
* Shape: 4, más común.
* MArgin: 1, más común.
* Density: 3, bajo. (Además, el más común)

```{r}
refCategory=names(data_dum) %in% c("BI-RADS_0", "Shape_4", "Margin_1", "Density_3")
data_dum = data_dum[, !refCategory]
head(data_dum)
```


<br>
